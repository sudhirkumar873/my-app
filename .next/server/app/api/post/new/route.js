"use strict";(()=>{var e={};e.id=904,e.ids=[904],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},73292:e=>{e.exports=require("fs/promises")},71017:e=>{e.exports=require("path")},46839:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>c});var o=r(49303),s=r(88716),p=r(60670),i=r(54393),n=r(9258),d=r(23650),u=r(73292);let c=async e=>{let t=r(71017),a=process.cwd();try{await (0,d.P)();let r=await e.formData(),o=r.get("postPhoto"),s=await o.arrayBuffer(),p=Buffer.from(s),c=t.join(a,"public","uploads",o.name);await (0,u.writeFile)(c,p),o=`/uploads/${o.name}`;let l=await i.Z.create({creator:r.get("creatorId"),caption:r.get("caption"),tag:r.get("tag"),postPhoto:o});return await l.save(),await n.Z.findByIdAndUpdate(r.get("creatorId"),{$push:{posts:l._id}},{new:!0,useFindAndModify:!1}),new Response(JSON.stringify(l),{status:200})}catch(e){return console.error(e),new Response("Failed to create a new post",{status:500})}},l=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/post/new/route",pathname:"/api/post/new",filename:"route",bundlePath:"app/api/post/new/route"},resolvedPagePath:"C:\\Users\\Lappy\\OneDrive\\Desktop\\Sudhir-File\\nextjs-project\\my-app\\app\\api\\post\\new\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:f}=l,g="/api/post/new/route";function w(){return(0,p.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},54393:(e,t,r)=>{r.d(t,{Z:()=>p});var a=r(11185),o=r.n(a);let s=new(o()).Schema({creator:{type:o().Schema.Types.ObjectId,ref:"User",required:!0},caption:{type:String,required:!0},postPhoto:{type:String,required:!0},tag:{type:String,required:!0},likes:{type:[{type:o().Schema.Types.ObjectId,ref:"User"}],default:[]},createdAt:{type:Date,default:Date.now}}),p=o().models.Post||o().model("Post",s)},9258:(e,t,r)=>{r.d(t,{Z:()=>p});var a=r(11185),o=r.n(a);let s=new(o()).Schema({clerkId:{type:String,required:!0,uinque:!0},firstName:{type:String,required:!0},lastName:{type:String,required:!0},username:{type:String,required:!0},email:{type:String,required:!0},profilePhoto:{type:String,required:!0},posts:{type:[{type:o().Schema.Types.ObjectId,ref:"Post"}],default:[]},savedPosts:{type:[{type:o().Schema.Types.ObjectId,ref:"Post"}],default:[]},likedPosts:{type:[{type:o().Schema.Types.ObjectId,ref:"Post"}],default:[]},followers:{type:[{type:o().Schema.Types.ObjectId,ref:"User"}],default:[]},following:{type:[{type:o().Schema.Types.ObjectId,ref:"User"}],default:[]},createdAt:{type:Date,default:Date.now}}),p=o().models.User||o().model("User",s)},23650:(e,t,r)=>{r.d(t,{P:()=>p});var a=r(11185),o=r.n(a);let s=!1,p=async()=>{if(o().set("strictQuery",!0),s){console.log("MongoDB is already connected");return}try{await o().connect(process.env.MONGODB_URL,{dbName:"my-app"}),s=!0,console.log("MongoDB is connected")}catch(e){console.log(e)}}},49303:(e,t,r)=>{e.exports=r(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948],()=>r(46839));module.exports=a})();